<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Два таймера</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: url("https://www.ganjawiki.io/images/1/1b/2008_1a.jpg") no-repeat center center fixed;
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
    gap: 20px;
    flex-wrap: wrap;
  }
  .container {
    text-align: center;
    background: rgba(157,201,157,0.95);
    padding: 25px 40px;
    border-radius: 15px;
    box-shadow: 0px 6px 15px rgba(0,0,0,0.2);
    min-width: 250px;
    position: relative;
    cursor: move;
    user-select: none;
  }
  .tooltip-container {
    display: inline-block;
    position: relative;
    cursor: pointer;
    font-weight: bold;
    color: #024502;
    border-radius: 6px;
    padding: 5px 14px;
    background-color: #A8D5A2;
    font-size: 12px;
    margin-top: 5px;
    border: 2px solid transparent;
    background-clip: padding-box;
  }
  .tooltip-container::after {
    content: "";
    position: absolute;
    top: -2px; left: -2px; right: -2px; bottom: -2px;
    border-radius: 8px;
    background: linear-gradient(90deg, #00ff88, #00aaff, #ff00ff, #00ff88);
    background-size: 300% 300%;
    z-index: -1;
    animation: glow 3s linear infinite;
  }
  @keyframes glow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .tooltip-popup {
    visibility: hidden;
    width: 220px;
    background-color: #ffffff;
    color: #333;
    text-align: left;
    border-radius: 8px;
    padding: 6px;
    position: absolute;
    z-index: 10;
    top: 50%;
    left: 105%;
    transform: translateY(-50%);
    box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
    font-size: 14px;
    line-height: 1.3;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .tooltip-container:hover .tooltip-popup {
    visibility: visible;
    opacity: 1;
  }
  .blink { animation: blink 1s infinite; }
  @keyframes blink { 0%,100%{opacity:1;}50%{opacity:0;} }
  button {
    padding: 8px 16px; font-size: 14px; font-weight: bold;
    border: none; border-radius: 8px; cursor: pointer;
    transition: background 0.3s; margin: 5px 5px 0 0; color: white;
  }
  #manualControlBtn { background: #024502; }
  #manualControlBtn:hover { background: #013201; }
  #manualStopBtn { background: red; }
  #manualStopBtn:hover { background: darkred; }
  #manualSetBtn { background: #013201; }
  #manualSetBtn:hover { background: #024502; }
  #timeInput { width:70px; padding:5px; font-size:14px; border-radius:5px; border:1px solid #555; margin-right:5px; text-align:center;}
  .credit a { color: #007bff; text-decoration: none; cursor: pointer; }
  .credit a:hover { text-decoration: underline; }
  .label { font-size:16px; margin-bottom:5px; font-weight:bold; color:green;}
  #nextRespAuto { font-size:28px; font-weight:bold; color:green; margin-bottom:10px;}
  #manualTime { font-size:28px; font-weight:bold; color:green; margin-bottom:10px;}
</style>
</head>
<body>

<!-- ===== Автоматический таймер ===== -->
<div class="container" id="autoTimerContainer">
  <div class="label">До респа:</div>
  <div id="nextRespAuto">00:00</div>
  <div class="tooltip-container">Респы поков
    <span class="tooltip-popup">
      <b>Расписание появления монстров:</b><br>
      :00, :03, :06, :09, :12, :15, :18, :21, :24, :27, :30, :33, :36, :39, :42, :45, :48, :51, :54, :57
    </span>
  </div>
</div>

<!-- ===== Старый ручной таймер ===== -->
<div class="container" id="manualTimerContainer">
  <div id="manualTime">00:00:00</div>
  <button id="manualControlBtn" onclick="toggleManualStopwatch()">Старт</button>
  <button id="manualStopBtn" onclick="stopManualStopwatch()">Стоп</button>
  <div style="margin-top:10px;">
    <input type="text" id="timeInput" placeholder="мм:сс">
    <button id="manualSetBtn" onclick="setManualTime()">Задать</button>
  </div>
  <div class="credit">
    <a id="creditLink"><b>+3 Ему :)</b></a>
  </div>
</div>

<!-- ===== Аудио ===== -->
<audio id="alert230Auto" src="https://www.myinstants.com/media/sounds/gta-lockon-alert.mp3" preload="auto"></audio>
<audio id="alert245Auto" src="https://www.myinstants.com/media/sounds/severe-thunderstorm-warning-ryan-hall-yall_V5kzHWO.mp3" preload="auto"></audio>
<audio id="alert300Auto" src="https://www.myinstants.com/media/sounds/metal-gear-alert-sound-effect_XKoHReZ.mp3" preload="auto"></audio>
<audio id="startSound" src="https://www.myinstants.com/media/sounds/police-beep.mp3" preload="auto"></audio>
<audio id="creditSound" src="https://www.myinstants.com/media/sounds/y2mate_xvijLIk.mp3" preload="auto"></audio>

<script>
/* ---------- Автоматический таймер ---------- */
let nextRespAuto = getNextRespTimeAuto();
function getNextRespTimeAuto() {
  const now = new Date();
  let nextMinute = Math.ceil(now.getMinutes()/3)*3;
  if(nextMinute>=60){ now.setHours(now.getHours()+1); nextMinute=0;}
  const nextResp = new Date(now.getFullYear(), now.getMonth(), now.getDate(),
                            now.getHours(), nextMinute,0,0);
  if(nextResp<=now){ nextResp.setMinutes(nextResp.getMinutes()+3);}
  return nextResp;
}

function updateRespTimerAuto(){
  const now = new Date();
  let diff = Math.floor((nextRespAuto-now)/1000);
  if(diff<=0){
    nextRespAuto.setMinutes(nextRespAuto.getMinutes()+3);
    diff = Math.floor((nextRespAuto-now)/1000);
  }
  const min = String(Math.floor(diff/60)).padStart(2,'0');
  const sec = String(diff%60).padStart(2,'0');
  const display = document.getElementById("nextRespAuto");
  display.textContent = `${min}:${sec}`;

  display.style.color="green";
  if(diff<=30) display.style.color="goldenrod";
  if(diff<=15) display.style.color="red";
  if(diff<=5) display.classList.add("blink");
  else display.classList.remove("blink");

  if(diff===30) document.getElementById("alert230Auto").play();
  if(diff===15) document.getElementById("alert245Auto").play();
  if(diff===0) document.getElementById("alert300Auto").play();
}
setInterval(updateRespTimerAuto,1000);

/* ---------- Старый ручной таймер ---------- */
let manualTimer, manualSeconds=0, manualRunning=false, firstManualStart=true;
function formatTime(sec){
  let h=String(Math.floor(sec/3600)).padStart(2,'0');
  let m=String(Math.floor((sec%3600)/60)).padStart(2,'0');
  let s=String(sec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}
function updateManualDisplay(){
  const display=document.getElementById("manualTime");
  display.textContent=formatTime(manualSeconds);
  display.classList.remove("blink");
  display.style.color="green";
  if(manualSeconds>=120 && manualSeconds<150) display.style.color="goldenrod";
  if(manualSeconds>=150 && manualSeconds<160) display.style.color="rgb(200,0,0)";
  if(manualSeconds>=160 && manualSeconds<170) display.style.color="rgb(220,0,0)";
  if(manualSeconds>=170 && manualSeconds<180){display.style.color="rgb(255,0,0)"; display.classList.add("blink");}
}
function manualTick(){manualSeconds++; if(manualSeconds>=180) manualSeconds=0; updateManualDisplay();}
function toggleManualStopwatch(){
  if(!manualRunning){manualTimer=setInterval(manualTick,1000); manualRunning=true;
    if(firstManualStart){document.getElementById("startSound").play(); firstManualStart=false;}
    document.getElementById("manualControlBtn").textContent="Сброс";
  } else {manualSeconds=0; updateManualDisplay();}
}
function stopManualStopwatch(){clearInterval(manualTimer); manualSeconds=0; manualRunning=false; firstManualStart=true; updateManualDisplay(); document.getElementById("manualControlBtn").textContent="Старт";}
function setManualTime(){
  const input=document.getElementById("timeInput").value.trim();
  if(!input) return;
  const parts=input.split(":").map(Number);
  let newSec=0;
  if(parts.length===2) newSec=parts[0]*60+parts[1];
  else if(parts.length===3) newSec=parts[0]*3600+parts[1]*60+parts[2];
  else return;
  if(newSec<0 || newSec>=180) newSec=0;
  manualSeconds=newSec; updateManualDisplay();
}

/* ---------- Клик по +3 Ему ---------- */
document.getElementById("creditLink").addEventListener("click",function(e){
  e.preventDefault();
  document.getElementById("creditSound").play();
  window.open("https://www.gwars.io/info.php?id=2360403","_blank");
});

/* ---------- Перетаскивание контейнеров ---------- */
function makeDraggable(el){
  let offsetX, offsetY, isDown=false;
  el.addEventListener("mousedown", e=>{isDown=true; offsetX=e.clientX-el.offsetLeft; offsetY=e.clientY-el.offsetTop;});
  document.addEventListener("mouseup", ()=>isDown=false);
  document.addEventListener("mousemove", e=>{if(isDown){el.style.left=(e.clientX-offsetX)+"px"; el.style.top=(e.clientY-offsetY)+"px"; el.style.position="absolute";}});
}
makeDraggable(document.getElementById("autoTimerContainer"));
makeDraggable(document.getElementById("manualTimerContainer"));
</script>

</body>
</html>
