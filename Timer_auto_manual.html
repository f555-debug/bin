<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Таймеры поков</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: url("https://www.ganjawiki.io/images/1/1b/2008_1a.jpg") no-repeat center center fixed;
  background-size: cover;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: sans-serif;
}
.container {
  text-align: center;
  background: rgba(157,201,157,0.95);
  padding: 25px 40px;
  border-radius: 15px;
  box-shadow: 0px 6px 15px rgba(0,0,0,0.2);
  min-width: 250px;
  position: relative;
  cursor: move;
  user-select: none;
  margin-bottom: 20px;
}
#autoLabel { font-weight:bold; font-size:16px; margin-bottom:5px; }
#nextResp { font-size:28px; font-weight:bold; margin-bottom:10px; color:green; }
.tooltip-container {
  display: inline-block;
  position: relative;
  cursor: pointer;
  font-weight: bold;
  color: #024502;
  border-radius: 6px;
  padding: 5px 14px;
  background-color: #A8D5A2;
  font-size: 12px;
  margin-top: 5px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.tooltip-container::after {
  content: "";
  position: absolute;
  top: -2px; left: -2px; right: -2px; bottom: -2px;
  border-radius: 8px;
  background: linear-gradient(90deg, #00ff88, #00aaff, #ff00ff, #00ff88);
  background-size: 300% 300%;
  z-index: -1;
  animation: glow 3s linear infinite;
}
@keyframes glow { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
.tooltip-popup {
  visibility: hidden;
  width: 240px;
  background-color: #ffffff;
  color: #333;
  text-align: left;
  border-radius: 8px;
  padding: 6px;
  position: absolute;
  z-index: 10;
  top: 50%;
  left: 105%;
  transform: translateY(-50%);
  box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
  font-size: 14px;
  line-height: 1.3;
  opacity: 0;
  transition: opacity 0.3s;
}
.tooltip-container:hover .tooltip-popup { visibility: visible; opacity: 1; }
.credit a { color:#007bff; text-decoration:none; cursor:pointer; }
.credit a:hover { text-decoration:underline; }

#muteBtn {
  position: absolute;
  bottom: 5px;
  left: 5px;
  font-size: 10px;
  padding: 2px 6px;
  background: #024502;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}
#muteBtn:hover { 
  background: #013201;
  box-shadow: 0 0 5px #00ff88;
  transform: scale(1.1);
}
#muteStatus {
  position: absolute;
  bottom: 6px;
  left: 50px; /* space from mute button */
  font-size: 10px;
  color: white;
}
</style>
</head>
<body>

<div class="container" id="autoTimerContainer">
  <div id="autoLabel">До респа подземки:</div>
  <div id="nextResp">00:00</div>
  <div class="tooltip-container">Респы поков
    <span class="tooltip-popup">
      Расписание респов:<br>
      <b>:00, :03, :06, :09, :12, :15, :18, :21, :24, :27, :30, :33, :36, :39, :42, :45, :48, :51, :54, :57</b>
    </span>
  </div>
  <button id="muteBtn">Mute</button>
  <span id="muteStatus">Sound ON</span>
</div>

<div class="container" id="manualTimerContainer">
  <div id="manualTime">00:00:00</div>
  <button id="manualControlBtn" onclick="toggleManualStopwatch()">Старт</button>
  <button id="manualStopBtn" onclick="stopManualStopwatch()">Стоп</button>
  <div style="margin-top:10px;">
    <input type="text" id="timeInput" placeholder="мм:сс">
    <button id="manualSetBtn" onclick="setManualTime()">Задать</button>
  </div>
  <div class="credit"><br><br>
    <a id="creditLink"><b>+3 Ему :)</b></a>
  </div>
</div>

<audio id="alert230" src="https://www.myinstants.com/media/sounds/gta-lockon-alert.mp3" preload="auto"></audio>
<audio id="alert245" src="https://www.myinstants.com/media/sounds/severe-thunderstorm-warning-ryan-hall-yall_V5kzHWO.mp3" preload="auto"></audio>
<audio id="alert300" src="https://www.myinstants.com/media/sounds/metal-gear-alert-sound-effect_XKoHReZ.mp3" preload="auto"></audio>
<audio id="startSound" src="https://www.myinstants.com/media/sounds/police-beep.mp3" preload="auto"></audio>
<audio id="creditSound" src="https://www.myinstants.com/media/sounds/y2mate_xvijLIk.mp3" preload="auto"></audio>

<script>
let nextResp=getNextRespTime();
let isMuted=false;

function getNextRespTime(){
  const now=new Date();
  let nextMinute=Math.floor(now.getMinutes()/3)*3+3;
  let nextHour=now.getHours();
  let d=now.getDate(), m=now.getMonth(), y=now.getFullYear();
  if(nextMinute>=60){ nextMinute%=60; nextHour+=1; if(nextHour>=24){ nextHour=0; const tmp=new Date(y,m,d+1); y=tmp.getFullYear(); m=tmp.getMonth(); d=tmp.getDate(); } }
  return new Date(y,m,d,nextHour,nextMinute,0,0);
}

function updateRespTimer(){
  const now=new Date();
  let diff=Math.floor((nextResp-now)/1000);
  if(diff<0){ nextResp=getNextRespTime(); diff=Math.floor((nextResp-now)/1000); }
  const minutes=String(Math.floor(diff/60)).padStart(2,'0');
  const seconds=String(diff%60).padStart(2,'0');
  const display=document.getElementById("nextResp");
  display.textContent=`${minutes}:${seconds}`;
  display.style.color="green";
  display.classList.remove("blink");
  if(diff<=30) display.style.color="goldenrod";
  if(diff<=15) display.style.color="red";
  if(diff<=5) display.classList.add("blink");
  if(!isMuted){
    if(diff===30) document.getElementById("alert230").play();
    if(diff===15) document.getElementById("alert245").play();
    if(diff===0) document.getElementById("alert300").play();
  }
}
setInterval(updateRespTimer,1000);

let autoAudioInited=false;
function initAutoAudio(){ 
  if(autoAudioInited) return;
  ["alert230","alert245","alert300"].forEach(id=>{ const a=document.getElementById(id); a.play().catch(()=>{}); a.pause(); a.currentTime=0; });
  autoAudioInited=true;
}
document.addEventListener("click", initAutoAudio, {once:true});

document.getElementById("muteBtn").addEventListener("click", function(){
    isMuted = !isMuted;
    this.textContent = isMuted ? "Unmute" : "Mute";
    document.getElementById("muteStatus").textContent = isMuted ? "Sound OFF" : "Sound ON";
});

let manualSeconds=0, manualRunning=false, manualTimer, firstManualStart=true;
function formatTime(sec){ let h=String(Math.floor(sec/3600)).padStart(2,'0'); let m=String(Math.floor((sec%3600)/60)).padStart(2,'0'); let s=String(sec%60).padStart(2,'0'); return `${h}:${m}:${s}`; }
function updateManualDisplay(){ const d=document.getElementById("manualTime"); d.textContent=formatTime(manualSeconds); d.classList.remove("blink"); d.style.color="green"; if(manualSeconds>=120&&manualSeconds<150)d.style.color="goldenrod"; if(manualSeconds>=150&&manualSeconds<160)d.style.color="rgb(200,0,0)"; if(manualSeconds>=160&&manualSeconds<170)d.style.color="rgb(220,0,0)"; if(manualSeconds>=170&&manualSeconds<180){d.style.color="rgb(255,0,0)";d.classList.add("blink");} }
function manualTick(){ manualSeconds++; if(manualSeconds>=180)manualSeconds=0; updateManualDisplay(); }
function toggleManualStopwatch(){ if(!manualRunning){ manualTimer=setInterval(manualTick,1000); manualRunning=true; if(firstManualStart){document.getElementById("startSound").play(); firstManualStart=false;} document.getElementById("manualControlBtn").textContent="Сброс"; } else {manualSeconds=0; updateManualDisplay();} }
function stopManualStopwatch(){ clearInterval(manualTimer); manualSeconds=0; manualRunning=false; firstManualStart=true; updateManualDisplay(); document.getElementById("manualControlBtn").textContent="Старт"; }
function setManualTime(){ const input=document.getElementById("timeInput").value.trim(); if(!input)return; const parts=input.split(":").map(Number); let newSec=0; if(parts.length===2)newSec=parts[0]*60+parts[1]; else if(parts.length===3)newSec=parts[0]*3600+parts[1]*60+parts[2]; else return; if(newSec<0||newSec>=180)newSec=0; manualSeconds=newSec; updateManualDisplay(); }

document.getElementById("creditLink").addEventListener("click",function(e){ e.preventDefault(); document.getElementById("creditSound").play(); window.open("https://www.gwars.io/info.php?id=2360403","_blank"); });

function makeDraggable(el){ let offsetX,offsetY,isDown=false; el.addEventListener("mousedown",e=>{isDown=true;offsetX=e.clientX-el.offsetLeft;offsetY=e.clientY-el.offsetTop;}); document.addEventListener("mouseup",()=>isDown=false); document.addEventListener("mousemove",e=>{if(isDown){el.style.left=(e.clientX-offsetX)+"px"; el.style.top=(e.clientY-offsetY)+"px"; el.style.position="absolute";}});}
makeDraggable(document.getElementById("autoTimerContainer"));
makeDraggable(document.getElementById("manualTimerContainer"));
</script>
</body>
</html>
